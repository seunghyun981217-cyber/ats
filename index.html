<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>ATS ìŠ¤ë§ˆíŠ¸ë§µ</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
body{
  margin:0;
  height:100vh;
  display:flex;
  font-family:system-ui,sans-serif;
}
.panel{
  width:360px;
  border-right:1px solid #ddd;
  padding:12px;
  overflow-y:auto;
}
#map{flex:1}
.result{
  padding:6px;
  border-bottom:1px dashed #ddd;
  cursor:pointer
}
.result:hover{background:#eef2ff}
@media(max-width:768px){
  body{flex-direction:column}
  .panel{width:100%;height:42vh}
  #map{height:58vh}
}
</style>
</head>

<body>

<div class="panel">
  <h3>ATS ìŠ¤ë§ˆíŠ¸ë§µ</h3>

  <input id="search" placeholder="ì´ë¦„ / ì„¤ëª… ê²€ìƒ‰" style="width:100%;margin-bottom:6px;padding:6px">

  <select id="district" style="width:100%;margin-bottom:6px">
    <option value="ALL">ì „ì²´ êµ¬</option>
  </select>

  <select id="type" style="width:100%;margin-bottom:6px">
    <option value="ALL">ì „ì²´ ìœ í˜•</option>
  </select>

  <h4>ê²°ê³¼ ëª©ë¡</h4>
  <div id="list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
</div>

<div id="map"></div>

<script>
let PLACES=[], markers=[], map, info;

// âœ… ìœ í˜•ë³„ ë§ˆì»¤ ìƒ‰ìƒ
const TYPE_COLOR={
  "ìˆ˜ë¦¬ ì§€ì •ì—…ì²´":"#E53935",
  "ì „ë™íœ ì²´ì–´ ì¶©ì „ì†Œ":"#1E88E5",
  "íœ ì²´ì–´ ëŒ€ì—¬ì†Œ":"#43A047",
  "íœ´ëŒ€ìš© ì¶©ì „ê¸° ëŒ€ì—¬ì†Œ":"#F9A825"
};

fetch('ats_places.csv')
  .then(r => r.text())
  .then(t => {
    const rows = t.trim().split(/\n/).slice(1);
    rows.forEach(r => {
      if (!r) return;
      const [name,district,type,lat,lng,description] = r.split(',');
      PLACES.push({
        name,
        district,
        type,
        lat: +lat,
        lng: +lng,
        description
      });
    });

    // âœ… ì—¬ê¸°ì„œ map ì´ˆê¸°í™”
    if (window.google && window.google.maps) {
      initMap();
    } else {
      console.error("Google Maps API ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨");
    }
  })
  .catch(e => {
    console.error("CSV ë¡œë“œ ì‹¤íŒ¨", e);
  });

function initMap(){
  map=new google.maps.Map(document.getElementById("map"),{
    center:{lat:37.52,lng:127.08},
    zoom:12,
    mapTypeControl:false
  });
  info=new google.maps.InfoWindow();
  initFilters();
  createMarkers();
  applyFilter();
}

function initFilters(){
  const dSel=document.getElementById("district");
  const tSel=document.getElementById("type");

  [...new Set(PLACES.map(p=>p.district))].forEach(d=>dSel.innerHTML+=`<option>${d}</option>`);
  [...new Set(PLACES.map(p=>p.type))].forEach(t=>tSel.innerHTML+=`<option>${t}</option>`);

  document.getElementById("search").oninput=applyFilter;
  dSel.onchange=tSel.onchange=applyFilter;
}

function createMarkers(){
  PLACES.forEach(p=>{
    const m=new google.maps.Marker({
      position:{lat:p.lat,lng:p.lng},
      map,
      icon:{
        path:google.maps.SymbolPath.CIRCLE,
        scale:7,
        fillColor:TYPE_COLOR[p.type]||"#666",
        fillOpacity:0.9,
        strokeColor:"#fff",
        strokeWeight:1
      }
    );
    m.place=p;
    m.onclick=()=>showInfo(m);
    markers.push(m);
  });
}

function showInfo(m){
  const p=m.place;
  info.setContent(`
    <b>${p.name}</b><br>
    ${p.district} Â· ${p.type}<br><br>
    ${p.description||""}<br><br>
    <a target="_blank"
      href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lng}">
      ğŸš— ê¸¸ì°¾ê¸°
    </a>
  `);
  info.open(map,m);
}

function applyFilter(){
  const d=document.getElementById("district").value;
  const t=document.getElementById("type").value;
  const q=document.getElementById("search").value.toLowerCase();
  const list=document.getElementById("list");
  list.innerHTML="";

  markers.forEach(m=>{
    const p=m.place;
    const ok =
      (d==="ALL"||p.district===d) &&
      (t==="ALL"||p.type===t) &&
      (!q||p.name.toLowerCase().includes(q)||(p.description||"").toLowerCase().includes(q));
    m.setVisible(ok);
    if(ok){
      const div=document.createElement("div");
      div.className="result";
      div.innerHTML=`<b>${p.name}</b><br>${p.district} Â· ${p.type}`;
      div.onclick=()=>{map.panTo({lat:p.lat,lng:p.lng});map.setZoom(15);showInfo(m);}
      list.appendChild(div);
    }
  });

  if(!list.innerHTML) list.innerText="ê²°ê³¼ ì—†ìŒ";
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRFrDGLMi8UZgAoDITyJu694vKXdTglbU"></script>
</body>
</html>
