<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ATS ë³´ì¡°ê¸°ê¸° ìŠ¤ë§ˆíŠ¸ë§µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Noto Sans KR", sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    .panel {
      width: 340px;
      background: #fff;
      border-right: 1px solid #e5e7eb;
      padding: 18px;
      overflow-y: auto;
    }

    .title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .section-label {
      margin-top: 16px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .chip {
      padding: 6px 12px;
      background: #f3f4f6;
      border-radius: 999px;
      cursor: pointer;
      font-size: 13px;
    }

    .chip.active {
      background: #1a73e8;
      color: #fff;
    }

    .search-input {
      flex: 1;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
    }

    .search-btn {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: #1a73e8;
      color: white;
      cursor: pointer;
      font-size: 14px;
    }

    .search-row {
      display: flex;
      gap: 6px;
      margin-top: 10px;
    }

    /* ì§€ë„ ìˆ¨ê¹€ ìƒíƒœ */
    #map {
      width: 100%;
      height: 100%;
      display: none;
    }

    /* ì§€ë„ í‘œì‹œ ìƒíƒœ */
    #map.show {
      display: block;
    }

    #guideMessage {
      margin: 14px 0;
      font-size: 13px;
      color: #666;
      line-height: 1.4;
    }

  </style>
</head>

<body>

  <div class="panel">
    <div class="title">ATS ë³´ì¡°ê¸°ê¸° ìŠ¤ë§ˆíŠ¸ë§µ</div>

    <div id="guideMessage">
      ğŸ—ºï¸ ì§€ë„ë¥¼ ë³´ë ¤ë©´ <b>êµ¬</b> ë˜ëŠ” <b>ìœ í˜•</b>ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.
    </div>

    <div class="section-label">â‘  êµ¬ ì„ íƒ</div>
    <div class="chip-row" id="districtChips">
      <div class="chip active" data-district="ALL">ì „ì²´</div>
      <div class="chip" data-district="ê´‘ì§„êµ¬">ê´‘ì§„êµ¬</div>
      <div class="chip" data-district="ì„±ë™êµ¬">ì„±ë™êµ¬</div>
      <div class="chip" data-district="ê°•ë™êµ¬">ê°•ë™êµ¬</div>
      <div class="chip" data-district="ì†¡íŒŒêµ¬">ì†¡íŒŒêµ¬</div>
      <div class="chip" data-district="ê°•ë‚¨êµ¬">ê°•ë‚¨êµ¬</div>
      <div class="chip" data-district="ì„œì´ˆêµ¬">ì„œì´ˆêµ¬</div>
    </div>

    <div class="section-label">â‘¡ ìœ í˜• ì„ íƒ</div>
    <div class="chip-row" id="typeChips"></div>

    <div class="section-label">â‘¢ ê²€ìƒ‰</div>
    <div class="search-row">
      <input id="searchInput" class="search-input" type="text" placeholder="ì˜ˆ: ìˆ˜ë¦¬, ì¶©ì „ì†Œ ë“±" />
      <button class="search-btn" onclick="applyFilters()">ê²€ìƒ‰</button>
    </div>
  </div>

  <div id="map"></div>

  <script>
    /* ---------------------
       ğŸ“Œ  ë°ì´í„° (PLACES)
       --------------------- */
    const PLACES = [
      /* ì—¬ê¸°ëŠ” ë„¤ ì›ë˜ index.htmlì— ìˆëŠ” PLACES ì „ì²´ ë°ì´í„° ê·¸ëŒ€ë¡œ ìœ ì§€ */
      /* --- ìƒëµ (ë„ˆì˜ ì›ë³¸ ë°ì´í„°ê°€ ì—¬ê¸° ê·¸ëŒ€ë¡œ ë“¤ì–´ê°) --- */
      /* ë‚˜ëŠ” ì´ ì½”ë“œë¥¼ ê±´ë“œë¦¬ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ê°€ì ¸ê°€ë„ë¡ í•´ë†¨ìŒ */
    ];

    /* ---------------------------
       ğŸ“Œ  ìƒ‰ìƒ / ì•„ì´ì½˜ ê´€ë ¨ ì„¤ì •
       --------------------------- */
    const DISTRICT_COLORS = {
      "ê´‘ì§„êµ¬": "#E53935",
      "ì„±ë™êµ¬": "#1E88E5",
      "ê°•ë™êµ¬": "#43A047",
      "ì†¡íŒŒêµ¬": "#8E24AA",
      "ê°•ë‚¨êµ¬": "#FB8C00",
      "ì„œì´ˆêµ¬": "#FDD835"
    };

    function getTypeIcon(type) {
      if (!type) return "ğŸ“";
      if (type.includes("ìˆ˜ë¦¬")) return "ğŸ”§";
      if (type.includes("ì¶©ì „")) return "âš¡";
      if (type.includes("ê³µê¸°")) return "ğŸ’¨";
      if (type.includes("ëŒ€ì—¬")) return "â™¿";
      return "ğŸ“";
    }

    /* ---------------------
       ğŸ“Œ  ì§€ë„ / ì „ì—­ ë³€ìˆ˜
       --------------------- */
    let map;
    let markers = [];
    let infoWindow;
    let activeDistrict = "ALL";
    let activeType = "ALL";

    function createMarkerIcon(color) {
      return {
        path: google.maps.SymbolPath.CIRCLE,
        fillColor: color,
        fillOpacity: 0.95,
        scale: 5,
        strokeColor: "#ffffff",
        strokeWeight: 1.3,
      };
    }

    /* ------------------------
        ğŸ“Œ  ì‹¤ì œ ì§€ë„ ìƒì„± í•¨ìˆ˜
        ------------------------ */
    function realInitMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 37.520257, lng: 127.080672 },
        zoom: 12,
        styles: [
          { elementType: "labels", stylers: [{ visibility: "off" }] },
          { featureType: "poi", stylers: [{ visibility: "off" }] },
          { featureType: "transit", stylers: [{ visibility: "off" }] },
          { featureType: "road", elementType: "labels", stylers: [{ visibility: "simplified" }] }
        ],
        mapTypeControl: false,
        streetViewControl: false,
      });

      infoWindow = new google.maps.InfoWindow();

      PLACES.forEach(place => {
        const color = DISTRICT_COLORS[place.district] || "#4285F4";
        const marker = new google.maps.Marker({
          position: { lat: place.lat, lng: place.lng },
          map,
          title: place.name,
          icon: createMarkerIcon(color),
        });

        marker.placeData = place;

        marker.addListener("click", () => {
          const p = marker.placeData;
          const icon = getTypeIcon(p.type);

          const content = `
            <div style="font-size:13px; max-width:240px;">
              <div style="font-weight:700; margin-bottom:4px;">${icon} ${p.name}</div>
              <div style="font-size:11px; color:#666;">${p.district} Â· ${p.type}</div>
              <div style="margin:6px 0;">${p.description || ""}</div>
              <a href="https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lng}"
                 target="_blank"
                 style="display:inline-block; padding:6px 8px; font-size:12px;
                        color:#1a73e8; border:1px solid #1a73e8; border-radius:6px;
                        text-decoration:none;">
                ê¸¸ì°¾ê¸°
              </a>
            </div>
          `;

          infoWindow.setContent(content);
          infoWindow.open(map, marker);
        });

        markers.push(marker);
      });
    }

    /* ----------------------------------------
        ğŸ“Œ  êµ¬/ìœ í˜• ì„ íƒ ì „ì—ëŠ” ì§€ë„ ìˆ¨ê¹€ ì²˜ë¦¬
        ---------------------------------------- */
    function showMapIfNeeded() {
      const mapDiv = document.getElementById("map");
      const guide = document.getElementById("guideMessage");

      const nothingSelected = (activeDistrict === "ALL" && activeType === "ALL");

      if (nothingSelected) {
        mapDiv.classList.remove("show");
        guide.style.display = "block";
        return;
      }

      mapDiv.classList.add("show");
      guide.style.display = "none";

      if (!window._mapInitialized && window._apiLoaded) {
        realInitMap();
        window._mapInitialized = true;
        applyFilters();
      }
    }

    /* --------------------------
        ğŸ“Œ Google Maps API ë¡œë“œ ì‹œ
        -------------------------- */
    function initMap() {
      window._apiLoaded = true;
      showMapIfNeeded();
    }

    /* ---------------------
        ğŸ“Œ í•„í„° ì ìš© í•¨ìˆ˜
        --------------------- */
    function applyFilters() {
      const search = document.getElementById("searchInput").value.trim().toLowerCase();

      markers.forEach(marker => {
        const p = marker.placeData;

        const matchDistrict = (activeDistrict === "ALL" || p.district === activeDistrict);
        const matchType = (activeType === "ALL" || p.type === activeType);
        const matchSearch =
          (!search ||
           p.name.toLowerCase().includes(search) ||
           p.type.toLowerCase().includes(search) ||
           p.description?.toLowerCase().includes(search));

        marker.setVisible(matchDistrict && matchType && matchSearch);
      });
    }

    /* -------------------------
        ğŸ“Œ  êµ¬ / ìœ í˜• ì¹© ì„¤ì •
        ------------------------- */
    function setupDistrictChips() {
      const chips = document.getElementById("districtChips");

      chips.onclick = (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;

        [...chips.children].forEach(c => c.classList.remove("active"));
        chip.classList.add("active");

        activeDistrict = chip.dataset.district;

        rebuildTypeChips();
        applyFilters();
        showMapIfNeeded();
      };
    }

    function rebuildTypeChips() {
      const typeArea = document.getElementById("typeChips");
      typeArea.innerHTML = "";

      let types = new Set();

      PLACES.forEach(p => {
        if (activeDistrict === "ALL" || p.district === activeDistrict) {
          types.add(p.type);
        }
      });

      const allChip = document.createElement("div");
      allChip.className = "chip active";
      allChip.dataset.type = "ALL";
      allChip.textContent = "ì „ì²´";
      typeArea.appendChild(allChip);

      [...types].forEach(t => {
        const chip = document.createElement("div");
        chip.className = "chip";
        chip.dataset.type = t;
        chip.textContent = t;
        typeArea.appendChild(chip);
      });

      typeArea.onclick = (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;

        [...typeArea.children].forEach(c => c.classList.remove("active"));
        chip.classList.add("active");

        activeType = chip.dataset.type;
        applyFilters();
        showMapIfNeeded();
      };
    }

    /* ---------------------
        ğŸ“Œ ì´ˆê¸° ì‹¤í–‰
        --------------------- */
    setupDistrictChips();
    rebuildTypeChips();

  </script>

  <!-- ğŸ”‘ ë„ˆì˜ Google Maps API í‚¤ ë„£ê¸° -->
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRFrDGLMi8UZgAoDITyJu694vKXdTglbU&callback=initMap"
    async defer></script>

</body>
</html>

